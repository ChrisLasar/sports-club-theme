{{- /*
  Unified Card Partial
  
  Renders a standardized card UI element using daisyUI card components.
  
  Contract:
    Input: A dict (map) with the following structure:
      - title (required): string - Primary heading
      - href (required): string - Link target URL
      - description (optional): string - Secondary text/excerpt
      - image (optional): map with resource (Hugo resource), alt, sizes, loading
      - primaryMeta (optional): string - First metadata line
      - secondaryMeta (optional): string - Second metadata line
      - badge (optional): string - Label/category badge
      - tags (optional): array of strings - List of tags
      - variant (optional): string - "default" or "compact"
  
    Output: HTML string (rendered card markup)
  
  Usage:
    {{ partial "card.html" (dict "title" "Example" "href" "/example/") }}
    
  See: /specs/001-unify-card-component/contracts/card-partial.md
*/ -}}

{{- /* Validate required fields */ -}}
{{ if not (and .title .href) }}
  {{ warnf "Card partial: missing required fields (title=%v, href=%v)" .title .href }}
  {{- /* Return empty string - no output */ -}}
{{ else }}
  {{- /* Determine variant class */ -}}
  {{ $variantClass := "" }}
  {{ if eq .variant "compact" }}
    {{ $variantClass = "card-sm" }}
  {{ end }}

  <article class="card {{ $variantClass }} bg-base-100 text-base-content shadow-xl hover:shadow-2xl transition-shadow flex flex-col h-full">
    {{- /* Optional: Image */ -}}
    {{ with .image }}
      {{ if .resource }}
        <figure>
          {{ partial "responsive-image.html" (dict 
            "resource" .resource 
            "alt" (.alt | default "") 
            "class" "w-full h-48 object-cover"
            "sizes" (.sizes | default "(min-width: 1024px) 320px, (min-width: 768px) 350px, (min-width: 640px) 450px, 100vw")
            "loading" (.loading | default "lazy")
          ) }}
        </figure>
      {{ end }}
    {{ end }}
    
    <div class="card-body flex flex-col flex-grow">
      {{- /* Optional: Badge */ -}}
      {{ with .badge }}
        <div class="mb-2">
          <span class="badge badge-primary">{{ . }}</span>
        </div>
      {{ end }}
      
      {{- /* Required: Title (linked) */ -}}
      <h2 class="card-title">
        <a href="{{ $.href }}" class="hover:text-primary transition-colors">{{ $.title }}</a>
      </h2>
      
      {{- /* Optional: Primary Metadata */ -}}
      {{ with .primaryMeta }}
        <div class="text-sm text-base-content/70">
          <span>{{ . }}</span>
        </div>
      {{ end }}
      
      {{- /* Optional: Secondary Metadata */ -}}
      {{ with .secondaryMeta }}
        <div class="text-xs text-base-content/60">
          <span>{{ . }}</span>
        </div>
      {{ end }}
      
      {{- /* Optional: Description */ -}}
      {{ with .description }}
        <p class="text-sm text-base-content/80 mt-2">{{ . }}</p>
      {{ end }}
      
      {{- /* Optional: Tags */ -}}
      {{ with .tags }}
        <div class="flex flex-wrap gap-2 mt-2">
          {{ range . }}
            <span class="badge badge-outline badge-sm">{{ . }}</span>
          {{ end }}
        </div>
      {{ end }}
      
      {{- /* Card Actions */ -}}
      <div class="card-actions justify-end mt-auto">
        <a href="{{ $.href }}" class="btn btn-primary {{ if eq $.variant "compact" }}btn-sm{{ end }}">{{ partial "i18n-term.html" (dict "key" "read_more") }}</a>
      </div>
    </div>
  </article>
{{ end }}
